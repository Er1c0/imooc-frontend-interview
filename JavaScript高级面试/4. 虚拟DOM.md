# 虚拟 DOM

- vdom 是 Vue 和 React 的核心
- vdom 比较独立，使用也比较简单
- 如果面试问到 Vue 和 React 和实现，免不了问 vdom，考察基础能力和自学能力

## vdom 是什么？为什么会存在 vdom？

### 什么是 vdom

- virtual dom，虚拟 DOM
- 用 JS 模拟 DOM 结构
- DOM 变化的对比，放在 JS 层来做
  - 前端的 HTML、CSS、JS 只有 JS 是图灵完备语言
  - 图灵完备语言：能实现各种逻辑的语言，判断、循环、递归，高复杂逻辑的语言
- 提高重绘性能

```html
<ul id="list">
  <li class="item">Item 1</li>
  <li class="item">Item 2</li>
</ul>
```

用 JS 来模拟上面的 DOM 结构

```js
{
  tag: 'ul',
  attrs: {
    id: 'list'
  },
  children: [
    {
      tag: 'li',
      attrs: { className: 'item' },
      children: ['Item 1']
    }, {
      tag: 'li',
      attrs: { className: 'item' },
      children: ['Item 2']
    }
  ]
}
```

### 设计一个需求场景

```json
// 1. 将该数据展示成一个表格
// 2， 随便修改一个信息，表格也跟着修改
[
  {
    "name": "张三",
    "age": "20",
    "address": "北京"
  },
  {
    "name": "李四",
    "age": "21",
    "address": "上海"
  },
  {
    "name": "王五",
    "age": "22",
    "address": "广州"
  }
]
```

### 用 jQuery 实现

```html
<div id="container"></div>
<button id="btn-change">change</button>

<script src="jquery.js"></script>
<script>
  var data = [
    {
      name: '张三',
      age: '20',
      address: '北京'
    },
    {
      name: '李四',
      age: '21',
      address: '上海'
    },
    {
      name: '王五',
      age: '22',
      address: '广州'
    }
  ]

  // 渲染函数
  function render(data) {
    var $container = $('#container')
    // 清空容器，重要！！
    $container.html('')

    // 拼接table
    var $table = $('<table>')
    $table.append($('<tr><td>name<td><td>age<td><td>address<td><tr>'))
    data.forEach(item => {
      $table.append(
        $(
          '<tr><td>' +
            item.name +
            '</td><td>' +
            item.age +
            '</td><td>' +
            item.address +
            '</td>/tr>'
        )
      )
    })
    // 渲染到页面
    $container.append($table)
  }

  // 修改信息
  $('#btn-change').click(function() {
    data[1].age = 30
    data[2].address = '深圳'
    // re-render 再次渲染
    render(data)
  })

  //页面加载完立刻执行（初次渲染）
  render(data)
</script>
```

### 遇到的问题

- DOM 的操作是非常昂贵的，js 的运行效率高
- 尽量减少 DOM 操作，而不是推倒重来
- 项目越复杂，影响就越严重
- vdom 即可解决这个问题

### 问题解答

- virtual DOM，虚拟 DOM
- 用 JS 模拟 DOM 结构
- DOM 操作非常昂贵
- 将 DOM 对比操作放在 JS 层，提高效率

## vdom 如何应用，核心 API 是什么？

## 介绍一下 diff 算法
